{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" type="text/css" href="{% static 'myapp/style.css' %}">
    <link rel="stylesheet" href="{% static 'myapp/footer.css' %}">
    <link rel="stylesheet" href="{% static 'myapp/header.css' %}">
    <link rel="stylesheet" href="{% static 'myapp/my_ads.css' %}">
</head>
<body>
 <header class="site-header">
    <div class="header-card">
        <!-- –õ–æ–≥–æ—Ç–∏–ø –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
        <div class="header-logo">
        <img src="{% static 'myapp/images/logo_header.png' %}" alt="ProMozgi" class="logo-img">
        </div>
        <div class="header-controls">
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <a href="{% url 'my_ads' %}" class="btn-outline">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
                    <button type="submit" class="btn-v">–í—ã–π—Ç–∏</button>

                </form>
            {% else %}
                <a href="{% url 'register' %}" class="btn-outline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                <a href="{% url 'login' %}?next={{ request.path }}" class="btn-v">–í–æ–π—Ç–∏</a>
            {% endif %}
            </div>

    </div>
    </header>      
    <a href="{% url 'teachers_list' %}" class="back-button">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤</a>

    <h1>–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h1>
        <p style ="text-align: center;">
            <a href="{% url 'create_teacher' %}" class="btn-outline">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
        </p>

        <div class="tabs">
            <button class="tab-button active" data-tab="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
            <button class="tab-button" data-tab="hidden">–°–∫—Ä—ã—Ç—ã–µ</button>
            <button class="tab-button" data-tab="moderation">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div id="active" class="tab-content active">
            {% if teachers %}
                {% for teacher in teachers %}
                {% if teacher.status == 'active' %}
                <div class="teacher-card" data-teacher-id="{{ teacher.id }}" data-status="active">
                    <a href="{% url 'teacher_details' teacher.id %}" class="teacher-link">
                        <div class="teacher-header">
                            {% if teacher.photo %}
                                <img src="{{ teacher.photo.url }}" alt="–§–æ—Ç–æ {{ teacher.fio }}" class="avatar">
                            {% else %}
                                <div class="avatar-placeholder">{{ teacher.fio|first }}</div>
                            {% endif %}
                            <h1 class="teacher-name">{{ teacher.fio }}</h1>
                        </div>
                        <p class="subjects">–ü—Ä–µ–¥–º–µ—Ç—ã: {{ teacher.subjects_list }}</p>
                        <p class="klass">–ö–ª–∞—Å—Å—ã: {{ teacher.klass_list }}</p>
                        <p class="price">–¶–µ–Ω–∞: {{ teacher.price }}</p>
                        {% if teacher.average_rating > 0 %}
                        <div class="teacher-rating">
                            <span class="rating-value">{{ teacher.average_rating }}</span>
                            <span class="star">‚òÖ</span>
                        </div>
                        {% else %}
                            <div class="teacher-rating">
                                <span class="rating-value">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</span>
                            </div>
                        {% endif %}
                    </a>
                    <div class="card-actions">
                        <button class="action-btn hide-btn" data-teacher-id="{{ teacher.id }}">–°–∫—Ä—ã—Ç—å</button>
                        <button class="action-btn delete-btn" data-teacher-id="{{ teacher.id }}">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            {% else %}
                <p style="color: #6c757d; text-align: center;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π.</p>
            {% endif %}

        </div>

        <div id="hidden" class="tab-content">
            {% if teachers %}
            {% for teacher in teachers %}
            {% if teacher.status == 'hidden' %}
            <div class="teacher-card" data-teacher-id="{{ teacher.id }}" data-status="hidden">
                <a href="{% url 'teacher_details' teacher.id %}" class="teacher-link">
                        <div class="teacher-header">
                            {% if teacher.photo %}
                                <img src="{{ teacher.photo.url }}" alt="–§–æ—Ç–æ {{ teacher.fio }}" class="avatar">
                            {% else %}
                                <div class="avatar-placeholder">{{ teacher.fio|first }}</div>
                            {% endif %}
                            <h1 class="teacher-name">{{ teacher.fio }}</h1>
                        </div>
                        <p class="subjects">–ü—Ä–µ–¥–º–µ—Ç—ã: {{ teacher.subjects_list }}</p>
                        <p class="klass">–ö–ª–∞—Å—Å—ã: {{ teacher.klass_list }}</p>
                        <p class="price">–¶–µ–Ω–∞: {{ teacher.price }}</p>
                        {% if teacher.average_rating > 0 %}
                        <div class="teacher-rating">
                            <span class="rating-value">{{ teacher.average_rating }}</span>
                            <span class="star">‚òÖ</span>
                        </div>
                        {% else %}
                            <div class="teacher-rating">
                                <span class="rating-value">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</span>
                            </div>
                        {% endif %}
                    </a>
                    <div class="card-actions">
                        <button class="action-btn restore-btn" data-teacher-id="{{ teacher.id }}">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button class="action-btn delete-btn" data-teacher-id="{{ teacher.id }}">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
            </div>
                {% endif %}
                {% endfor %}
            {% else %}
                <p style="color: #6c757d; text-align: center;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π.</p>
            {% endif %}
        </div>

        <div id="moderation" class="tab-content">
            {% if teachers %}
            {% for teacher in teachers %}
            {% if teacher.status == 'moderation' %}
            <div class="teacher-card">
                <a href="{% url 'teacher_details' teacher.id %}" class="teacher-link">
                        <div class="teacher-header">
                            {% if teacher.photo %}
                                <img src="{{ teacher.photo.url }}" alt="–§–æ—Ç–æ {{ teacher.fio }}" class="avatar">
                            {% else %}
                                <div class="avatar-placeholder">{{ teacher.fio|first }}</div>
                            {% endif %}
                            <h1 class="teacher-name">{{ teacher.fio }}</h1>
                        </div>
                        <p class="subjects">–ü—Ä–µ–¥–º–µ—Ç—ã: {{ teacher.subjects_list }}</p>
                        <p class="klass">–ö–ª–∞—Å—Å—ã: {{ teacher.klass_list }}</p>
                        <p class="price">–¶–µ–Ω–∞: {{ teacher.price }}</p>
                        {% if teacher.average_rating > 0 %}
                        <div class="teacher-rating">
                            <span class="rating-value">{{ teacher.average_rating }}</span>
                            <span class="star">‚òÖ</span>
                        </div>
                        {% else %}
                            <div class="teacher-rating">
                                <span class="rating-value">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</span>
                            </div>
                        {% endif %}
                    </a>
            </div>
                {% endif %}
                {% endfor %}
            {% else %}
                <p style="color: #6c757d; text-align: center;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π.</p>
            {% endif %}
        </div>
        
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. –°–ö–†–ò–ü–¢ –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                tabButtons.forEach(btn => btn.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                this.classList.add('active');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã
                tabContents.forEach(content => content.classList.remove('active'));
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // 2. –°–ö–†–ò–ü–¢ –î–õ–Ø –ö–ù–û–ü–û–ö –£–ü–†–ê–í–õ–ï–ù–ò–Ø –û–ë–™–Ø–í–õ–ï–ù–ò–Ø–ú–ò
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('hide-btn')) {
                const teacherId = e.target.getAttribute('data-teacher-id');
                changeTeacherStatus(teacherId, 'hidden');
            }
            
            if (e.target.classList.contains('delete-btn')) {
                const teacherId = e.target.getAttribute('data-teacher-id');
                deleteTeacher(teacherId);
            }
            
            if (e.target.classList.contains('restore-btn')) {
                const teacherId = e.target.getAttribute('data-teacher-id');
                changeTeacherStatus(teacherId, 'active');
            }
        });
        
        // 3. –§–£–ù–ö–¶–ò–ò –î–õ–Ø AJAX-–ó–ê–ü–†–û–°–û–í
        function changeTeacherStatus(teacherId, newStatus) {
            let message = '';
            if (newStatus === 'hidden') {
                message = '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–∫—Ä—ã—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?';
            } else if (newStatus === 'active') {
                message = '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?';
            }
            
            if (message && !confirm(message)) {
                return;
            }
            
            fetch(`/teacher/${teacherId}/status/${newStatus}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
            });
        }
        
        function deleteTeacher(teacherId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?')) {
                return;
            }
            
            fetch(`/teacher/${teacherId}/delete/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞ –∏–∑ cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
    </script>

    <footer class="site-footer">
        <div class="footer-card">
          <div class="footer-brand">
            <img src="{% static 'myapp/images/logo_footer.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="footer-logo">
            <p>–ù–∞–π–¥–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç</p>
          </div>

          <div class="footer-contacts">
            <p>üìß promozgi@mail.ru</p>
            <p>üìû +375 (29) 777 77 77</p>
          </div>

          <div class="footer-social">
            <a href="#" class="social-link">Telegram</a>
            <a href="#" class="social-link">VK</a>
            <a href="#" class="social-link">WhatsApp</a>
          </div>

          <div class="footer-legal">
            <p>¬© 2025 ProMozgi. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p>
              <a href="/privacy/">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> | 
              <a href="/terms/">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
            </p>
          </div>
        </div>
    </footer>
</body>
</html>